<!DOCTYPE html>
<html>

<head>
	<meta charset="ISO-8859-1">
	<title>Find Requests</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script>
		function home() {
			window.location = "http://localhost:8080/project-1/manager/Mhome.html"
		}

		function findRequests() {
			console.log("findRequests() started")
			let resolveForm = document.resolveForm;
			let userString = sessionStorage.getItem('currentUser');
			let currentUser = JSON.parse(userString);

			let empl = document.getElementById('empl').value;

			const requesttemplate = {
				manager: currentUser.username,
				employee: empl,
			}

			let xhr = new XMLHttpRequest();

			xhr.onreadystatechange = function () {
				console.log("Processing")
				if (this.readyState === 4 && this.status === 200) {
					console.log("Success");
					document.getElementById("warningText").innerHTML = this.responseText;
					console.log(this.responseText);
				}
				if (this.readyState === 4 && this.status === 204) {
					console.log("Failed");
					let childDiv = document.getElementById("warningText")
					childDiv.textContent = "Failed"
				}
			}

			xhr.open("POST", "http://localhost:8080/project-1/requests");
			xhr.send(JSON.stringify(requesttemplate));
		}
	</script>
</head>

<body>

	<div class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 id="welcome">Welcome to Requests</h1>
			<script>
				let welcome = document.getElementById('welcome');
				let userString = sessionStorage.getItem('currentUser');
				let currentUser = JSON.parse(userString);
				if (userString === null) {
					window.location = "http://localhost:8080/project-1/index.html"
				} else {
					console.log(currentUser);
					if (currentUser != null) {
						welcome.innerHTML = "Welcome to Requests " + currentUser.username;
					}
				}
			</script>
		
		<!-- This script will be defined in index.js -->
		<form name="resolveForm" onsubmit="findRequests(event.preventDefault())">
			<!--  I may have prevent default() -->

			<div class="form-group">
				<label for="empl">Employee Username</label> <input type="text" class="form-control" required name="empl"
					id="empl" placeholder="Enter username">
			</div>

			<button id="login" type="submit" class="btn btn-primary" value="Submit">Submit</button>
		</form>
		<br>
		<button class="btn btn-primary" onclick="home()">GO BACK</button>
		<br><br>
		<div id="warningText"></div>
		</div>
	</div>
</body>

</html>